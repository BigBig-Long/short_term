<!doctype html>
<html lang="en">

    <head>
        <meta charset="utf-8">
        <title>标签词云图</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta content="Premium Multipurpose Admin & Dashboard Template" name="description">
        <meta content="Themesdesign" name="author">
                <meta name="referrer" content="no-referrer" />

        <link href="/static/css/dataTables.bootstrap4.min.css" rel="stylesheet" type="text/css">
        <link href="/static/css/buttons.bootstrap4.min.css" rel="stylesheet" type="text/css">
        <link href="/static/css/responsive.bootstrap4.min.css" rel="stylesheet" type="text/css">
        <link href="/static/css/bootstrap.min.css" rel="stylesheet" type="text/css">
        <link href="/static/css/icons.min.css" rel="stylesheet" type="text/css">
        <link href="/static/css/app.min.css" rel="stylesheet" type="text/css">
<script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    </head>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f7fa;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
            padding: 25px;
        }
        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 30px;
            font-size: 28px;
            font-weight: 600;
        }
        .chart-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            gap: 25px;
            margin-top: 20px;
        }
        .chart-box {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            flex: 1;
            min-width: 300px;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .chart-box:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }
        .chart-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
            color: #2c3e50;
            text-align: center;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }
        .chart {
            height: 320px;
            width: 100%;
        }
        .description {
            margin-top: 30px;
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: 10px;
            line-height: 1.7;
            color: #555;
        }
        .header-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }
        .info-card {
            background-color: #fff;
            border-radius: 10px;
            padding: 15px 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            flex: 1;
            margin: 0 10px;
            text-align: center;
            transition: transform 0.3s ease;
        }
        .info-card:hover {
            transform: translateY(-5px);
        }
        .info-card h3 {
            margin: 0;
            font-size: 16px;
            color: #7f8c8d;
        }
        .info-card p {
            margin: 10px 0 0;
            font-size: 24px;
            font-weight: 600;
            color: #2c3e50;
        }
        .trend-up {
            color: #27ae60;
        }
        .trend-down {
            color: #e74c3c;
        }
    </style>
    <body data-topbar="colored">

        <!-- Begin page -->
        <div id="layout-wrapper">

            <header id="page-topbar">
                <div class="navbar-header">
                    <div class="d-flex">
                        <!-- LOGO -->
                        <div class="navbar-brand-box">
                            <a href="#" class="logo logo-dark" style="font-size:20px;font-weight: bold">
                                房屋数据分析预测系统
                            </a>

                            <a href="" class="logo logo-light">
                                <span class="logo-sm">
                                    <img src="static/picture/logo-sm-light.png" alt="" height="22">
                                </span>
                                <span class="logo-lg">
                                    <img src="static/picture/logo-light.png" alt="" height="20">
                                </span>
                            </a>
                        </div>

                        <button type="button" class="btn btn-sm px-3 font-size-24 header-item waves-effect" id="vertical-menu-btn">
                            <i class="mdi mdi-backburger"></i>
                        </button>

                        <!-- App Search-->
                        <form class="app-search d-none d-lg-block">
                            <div class="position-relative">
                                <input onclick="toSearch()" type="text" class="form-control" placeholder="Search...">
                                <span  class="mdi mdi-magnify"></span>
                                <script>
                                    const toSearch = () =>{
                                        window.location.href = 'http://localhost:5000/page/search'
                                    }
                                </script>
                            </div>
                        </form>
                    </div>

                    <div class="d-flex">

                        <div class="dropdown d-inline-block">
                            <button type="button" class="btn header-item waves-effect" id="page-header-user-dropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <span class="d-none d-sm-inline-block ml-1">{{ username }}</span>
                                <i class="mdi mdi-chevron-down d-none d-sm-inline-block"></i>
                            </button>
                            <div class="dropdown-menu dropdown-menu-right">
                                <a class="dropdown-item" href="/user/logOut"><i class="mdi mdi-logout font-size-16 align-middle mr-1"></i> 退出登录</a>
                            </div>
                        </div>

                    </div>
                </div>

            </header>

            <!-- ========== Left Sidebar Start ========== -->
            <div class="vertical-menu">

                <div data-simplebar="" class="h-100">

                    <!--- Sidemenu -->
                    <div id="sidebar-menu">
                        <!-- Left Menu Start -->
                        <ul class="metismenu list-unstyled" id="side-menu">
                            <li class="menu-title">首页菜单</li>

                            <li>
                                <a href="/page/home" class="waves-effect">
                                    <div class="d-inline-block icons-sm mr-1"><i class="uim uim-airplay"></i></div>
                                    <span>首页</span>
                                </a>
                            </li>

                            <li>
                                <a href="/page/search" class=" waves-effect">
                                    <div class="d-inline-block icons-sm mr-1"><i class="uim uim-schedule"></i></div>
                                    <span>搜索分类</span>
                                </a>
                            </li>

                            <li>
                                <a href="/page/tableData" class="waves-effect">
                                    <div class="d-inline-block icons-sm mr-1"><i class="uim uim-comment-message"></i></div>
                                    <span>数据操作</span>
                                </a>
                            </li>
                            <li class="menu-title">数据可视化</li>

                            <li>
                                <a href="/page/priceChar" class="waves-effect">
                                    <div class="d-inline-block icons-sm mr-1"><i class="uim uim-sign-in-alt"></i></div>
                                    <span>房屋价格分析</span>
                                </a>
                            </li>

                            <li>
                                <a href="/page/detailChar" class="waves-effect">
                                    <div class="d-inline-block icons-sm mr-1"><i class="uim uim-grids"></i></div>
                                    <span>房屋详情分析</span>
                                </a>
                            </li>


                            <li>
                                <a href="/page/typeChar" class="waves-effect">
                                    <div class="d-inline-block icons-sm mr-1"><i class="uim uim-box"></i></div>
                                    <span>房屋类型分析</span>
                                </a>
                            </li>

                            <li>
                                <a href="/page/anthorChar" class="waves-effect">
                                    <div class="d-inline-block icons-sm mr-1"><i class="uim uim-layer-group"></i></div>
                                    <span>房屋其他分析</span>
                                </a>
                            </li>
                            <li class="menu-title">词云图</li>
                            <li>
                                <a href="/page/companyCloud" class="waves-effect">
                                    <div class="d-inline-block icons-sm mr-1"><i class="uim uim-object-ungroup"></i></div>
                                    <span>公司词云图</span>
                                </a>
                            </li>

                            <li>
                                <a href="/page/tagCloud" class="waves-effect">
                                    <div class="d-inline-block icons-sm mr-1"><i class="uim uim-table"></i></div>
                                    <span>标签词云图</span>
                                </a>
                            </li>
                            <li class="menu-title">人工智能</li>

                            <li>
                                <a href="/page/pricePred" class="waves-effect">
                                    <div class="d-inline-block icons-sm mr-1"><i class="uim uim-document-layout-left"></i></div>
                                    <span>房价预测</span>
                                </a>
                            </li>
                        </ul>
                    </div>
                    <!-- Sidebar -->
                </div>
            </div>
            <!-- Left Sidebar End -->
            <!-- ============================================================== -->
            <!-- Start right Content here -->
            <!-- ============================================================== -->
            <div class="main-content">
                <div class="page-content">
                    <!-- Page-Title -->
                    <div class="page-title-box">
                        <div class="container-fluid">
                            <div class="row align-items-center">
                                <div class="col-md-8">
                                    <h4 class="page-title mb-1">标签词云图</h4>
                                    <ol class="breadcrumb m-0">
                                        <li class="breadcrumb-item"><a href="javascript: void(0);">词云图</a></li>
                                    <li class="breadcrumb-item active">标签词云图</li>
                                    </ol>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- end page title end breadcrumb -->

                    <div class="page-content-wrapper">
                        <div class="container-fluid">
                            <div class="row">
                                <div class="col-12">
                                    <div class="card">
                                        <div class="card-body">
<div class="container">
        <h1>市场热度分析</h1>
        <div class="header-info">
            <div class="info-card">
                <h3>平均成交价</h3>
                <p class="trend-up">¥{{ average_price }} 万元</p>
            </div>
            <div class="info-card">
                <h3>最热小区</h3>
                <p class="trend-up">MVP {{ hottest_community }}</p>
            </div>
            <div class="info-card">
                <h3>平均成交周期</h3>
                <p class="trend-down">-{{ averageTime }} 天-</p>
            </div>
            <div class="info-card">
                <h3>市场热度指数</h3>
                <p class="trend-up">-{{ heat_index }}-</p>
            </div>
        </div>

        <div class="description">
            <p>以下图表从多个维度分析市场热度，包括价格趋势、区域热度、建筑类型偏好、市场供需关系等。通过这些图表可以全面了解当前房地产市场的活跃程度和趋势变化。</p>
        </div>

          <div class="chart-container">
            <div class="chart-box" style="width: 100%">
                <div class="chart-title" style="width: 100%">区域热度对比</div>
                <div id="areaHeatChart" class="chart"></div>
            </div>
            <div class="chart-box">
                <div class="chart-title">建筑类型偏好</div>
                <div id="buildingTypeChart" class="chart"></div>
            </div>
              <div class="chart-box">
                <div class="chart-title">成交价格与面积的关系</div>
                <div id="priceAreaChart" class="chart"></div>
            </div>
              <div class="chart-box">
                <div class="chart-title" >成交渠道转化漏斗</div>
                <div id="funnelChart" class="chart"></div>
            </div>
        </div>
    </div>

    <script>
        // 模拟数据集
        const data = [
            {小区名称: '都会风尚', 行政区域: '锦江', 片区: '合江亭', 户型: '3室1厅', 建筑面积: 143.58, 成交价: 240, 挂牌价: 265, 单价: 16716, 成交周期: 9, 成交日期: '2017-08-07', 成交渠道: '链家', 朝向: '东北', 装修: '其他', 电梯: '有', 楼层: '高楼层', 总楼层: 32, 建筑年份: 2009, 建筑类型: '板楼'},
            {小区名称: '都会风尚', 行政区域: '锦江', 片区: '合江亭', 户型: '3室2厅', 建筑面积: 117.79, 成交价: 128, 挂牌价: 136, 单价: 10867, 成交周期: 80, 成交日期: '2016-03-12', 成交渠道: '链家', 朝向: '东北', 装修: '精装', 电梯: '有', 楼层: '低楼层', 总楼层: 32, 建筑年份: 2009, 建筑类型: '板楼'},
            {小区名称: '都会风尚', 行政区域: '锦江', 片区: '合江亭', 户型: '3室1厅', 建筑面积: 117.09, 成交价: 135, 挂牌价: 138, 单价: 11530, 成交周期: 236, 成交日期: '2016-01-28', 成交渠道: '链家', 朝向: '北', 装修: '精装', 电梯: '有', 楼层: '中楼层', 总楼层: 32, 建筑年份: 2009, 建筑类型: '板楼'},
            {小区名称: '城市之光', 行政区域: '武侯', 片区: '桐梓林', 户型: '2室1厅', 建筑面积: 85.42, 成交价: 185, 挂牌价: 195, 单价: 21659, 成交周期: 30, 成交日期: '2017-09-15', 成交渠道: '贝壳', 朝向: '南', 装修: '简装', 电梯: '有', 楼层: '中楼层', 总楼层: 28, 建筑年份: 2010, 建筑类型: '塔楼'},
            {小区名称: '翡翠城', 行政区域: '高新', 片区: '金融城', 户型: '4室2厅', 建筑面积: 168.25, 成交价: 420, 挂牌价: 450, 单价: 25000, 成交周期: 45, 成交日期: '2017-07-20', 成交渠道: '我爱我家', 朝向: '南北', 装修: '精装', 电梯: '有', 楼层: '高楼层', 总楼层: 33, 建筑年份: 2012, 建筑类型: '板楼'},
            {小区名称: '蓝光COCO时代', 行政区域: '成华', 片区: '建设路', 户型: '2室1厅', 建筑面积: 78.36, 成交价: 158, 挂牌价: 165, 单价: 20165, 成交周期: 60, 成交日期: '2016-12-05', 成交渠道: '链家', 朝向: '东', 装修: '毛坯', 电梯: '有', 楼层: '低楼层', 总楼层: 30, 建筑年份: 2011, 建筑类型: '塔楼'},
            {小区名称: '龙湖时代天街', 行政区域: '武侯', 片区: '红牌楼', 户型: '3室2厅', 建筑面积: 105.68, 成交价: 235, 挂牌价: 250, 单价: 22243, 成交周期: 25, 成交日期: '2017-06-30', 成交渠道: '贝壳', 朝向: '西南', 装修: '精装', 电梯: '有', 楼层: '中楼层', 总楼层: 26, 建筑年份: 2013, 建筑类型: '板楼'},
            {小区名称: '中铁奥维尔', 行政区域: '温江', 片区: '大学城', 户型: '3室2厅', 建筑面积: 124.75, 成交价: 185, 挂牌价: 198, 单价: 14826, 成交周期: 70, 成交日期: '2016-11-18', 成交渠道: '我爱我家', 朝向: '东南', 装修: '简装', 电梯: '有', 楼层: '高楼层', 总楼层: 31, 建筑年份: 2014, 建筑类型: '板楼'},
            {小区名称: '保利198', 行政区域: '青羊', 片区: '光华', 户型: '2室2厅', 建筑面积: 92.58, 成交价: 198, 挂牌价: 210, 单价: 21396, 成交周期: 40, 成交日期: '2017-05-22', 成交渠道: '麦田', 朝向: '西南', 装修: '精装', 电梯: '有', 楼层: '中楼层', 总楼层: 29, 建筑年份: 2010, 建筑类型: '塔楼'},
            {小区名称: '华润凤凰城', 行政区域: '天府新区', 片区: '华阳', 户型: '4室2厅', 建筑面积: 142.85, 成交价: 350, 挂牌价: 370, 单价: 24500, 成交周期: 35, 成交日期: '2017-04-10', 成交渠道: '贝壳', 朝向: '南北', 装修: '精装', 电梯: '有', 楼层: '高楼层', 总楼层: 32, 建筑年份: 2015, 建筑类型: '板楼'},
            {小区名称: '中海国际社区', 行政区域: '锦江', 片区: '三圣乡', 户型: '3室2厅', 建筑面积: 115.26, 成交价: 265, 挂牌价: 280, 单价: 23000, 成交周期: 28, 成交日期: '2017-03-15', 成交渠道: '链家', 朝向: '南北', 装修: '精装', 电梯: '有', 楼层: '中楼层', 总楼层: 27, 建筑年份: 2013, 建筑类型: '板楼'},
            {小区名称: '绿地锦天府', 行政区域: '高新区南区', 片区: '大源', 户型: '3室1厅', 建筑面积: 108.32, 成交价: 285, 挂牌价: 300, 单价: 26300, 成交周期: 32, 成交日期: '2017-02-28', 成交渠道: '贝壳', 朝向: '南', 装修: '精装', 电梯: '有', 楼层: '高楼层', 总楼层: 25, 建筑年份: 2016, 建筑类型: '板楼'},
            {小区名称: '蓝光林肯公园', 行政区域: '龙泉驿', 片区: '龙泉', 户型: '3室2厅', 建筑面积: 112.54, 成交价: 178, 挂牌价: 185, 单价: 15818, 成交周期: 55, 成交日期: '2016-12-10', 成交渠道: '我爱我家', 朝向: '东', 装修: '简装', 电梯: '有', 楼层: '中楼层', 总楼层: 30, 建筑年份: 2014, 建筑类型: '塔楼'},
            {小区名称: '金科一城', 行政区域: '天府新区', 片区: '万安', 户型: '2室1厅', 建筑面积: 88.75, 成交价: 165, 挂牌价: 172, 单价: 18590, 成交周期: 48, 成交日期: '2016-11-25', 成交渠道: '麦田', 朝向: '西', 装修: '毛坯', 电梯: '有', 楼层: '低楼层', 总楼层: 28, 建筑年份: 2012, 建筑类型: '板楼'},
            {小区名称: '金地格林世界', 行政区域: '温江', 片区: '金马', 户型: '3室2厅', 建筑面积: 125.68, 成交价: 198, 挂牌价: 208, 单价: 15755, 成交周期: 65, 成交日期: '2016-10-18', 成交渠道: '链家', 朝向: '南', 装修: '简装', 电梯: '有', 楼层: '高楼层', 总楼层: 31, 建筑年份: 2011, 建筑类型: '板楼'},
        ];

        // 处理数据
        const processData = () => {
            // 按区域统计
            const areaData = {};
            data.forEach(item => {
                if (!areaData[item.行政区域]) {
                    areaData[item.行政区域] = {
                        count: 0,
                        totalPrice: 0,
                        area: 0
                    };
                }
                areaData[item.行政区域].count += 1;
                areaData[item.行政区域].totalPrice += item.成交价;
                areaData[item.行政区域].area += item.建筑面积;
            });

            // 按建筑类型统计
            const buildingTypeData = {};
            data.forEach(item => {
                if (!buildingTypeData[item.建筑类型]) {
                    buildingTypeData[item.建筑类型] = 0;
                }
                buildingTypeData[item.建筑类型] += 1;
            });

            // 按装修情况统计
            const decorationData = {};
            data.forEach(item => {
                if (!decorationData[item.装修]) {
                    decorationData[item.装修] = 0;
                }
                decorationData[item.装修] += 1;
            });

            return {
                areaData,
                buildingTypeData,
                decorationData
            };
        };
         // 9. 成交渠道转化漏斗图
        const funnelOption = {
            tooltip: {
                trigger: 'item',
                formatter: '{a} <br/>{b}: {c} ({d}%)'
            },
            legend: {
                data: ['咨询', '看房', '报价', '谈判', '签约', '成交']
            },
            series: [
                {
                    name: '转化率',
                    type: 'funnel',
                    left: '10%',
                    top: 60,
                    bottom: 60,
                    width: '80%',
                    min: 0,
                    max: 1000,
                    minSize: '0%',
                    maxSize: '100%',
                    sort: 'descending',
                    gap: 2,
                    label: {
                        show: true,
                        position: 'inside'
                    },
                    labelLine: {
                        length: 10,
                        lineStyle: {
                            width: 1,
                            type: 'solid'
                        }
                    },
                    itemStyle: {
                        borderColor: '#fff',
                        borderWidth: 1
                    },
                    emphasis: {
                        label: {
                            fontSize: 14
                        }
                    },
                    data: [
                        { value: 1000, name: '咨询' },
                        { value: 750, name: '看房' },
                        { value: 500, name: '报价' },
                        { value: 300, name: '谈判' },
                        { value: 150, name: '签约' },
                        { value: 100, name: '成交' }
                    ]
                }
            ]
        };

        const processedData = processData();

        // 初始化所有图表
        const areaHeatChart = echarts.init(document.getElementById('areaHeatChart'));
        const buildingTypeChart = echarts.init(document.getElementById('buildingTypeChart'));
        const priceAreaChart = echarts.init(document.getElementById('priceAreaChart'));
        const funnelChart = echarts.init(document.getElementById('funnelChart'));

       // 2. 区域热度对比 - 柱状图
const areaHeatOption = {
    tooltip: {
        trigger: 'axis',
        axisPointer: {
            type: 'shadow'
        }
    },
    grid: {
        left: '3%',
        right: '4%',
        bottom: '3%',
        containLabel: true
    },
    xAxis: {
        type: 'category',
        data: {{ districts | tojson }},
        name: '区域'
    },
    yAxis: {
        type: 'value',
        name: '成交量'
    },
    series: [
        {
            name: '成交量',
            type: 'bar',
            data: {{ counts | tojson }},
            itemStyle: {
                color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [ // 修改渐变方向为垂直
                    { offset: 0, color: '#83bff6' },
                    { offset: 0.5, color: '#188df0' },
                    { offset: 1, color: '#188df0' }
                ])
            }
        }
    ]
};

const buildingTypeOption = {
    tooltip: {
        trigger: 'item',
        formatter: '{a} <br/>{b}: {c} ({d}%)'
    },
    legend: {
        orient: 'vertical',
        right: 10,
        top: 'center',
        data: Object.keys(processedData.buildingTypeData)
    },
    series: [
        {
            name: '建筑类型',
            type: 'pie',
            radius: ['45%', '70%'],
            avoidLabelOverlap: false,
            itemStyle: {
                borderRadius: 10,
                borderColor: '#fff',
                borderWidth: 2
            },
            label: {
                show: false,
                position: 'center'
            },
            emphasis: {
                label: {
                    show: true,
                    fontSize: '16',
                    fontWeight: 'bold'
                }
            },
            labelLine: {
                show: false
            },
            data: Object.keys(JSON.parse('{{ building_type_counts | tojson }}')).map(key => ({
                name: key,
                value: JSON.parse('{{ building_type_counts | tojson }}')[key]
            }))
        }
    ]
};
  // 8. 成交价格与面积的关系散点图
        const priceAreaOption = {
            tooltip: {
                trigger: 'item',
                formatter: '面积: {c[0]} 平方米<br/>价格: {c[1]} 万元'
            },
            grid: {
                left: '3%',
                right: '4%',
                bottom: '3%',
                containLabel: true
            },
            xAxis: {
                type: 'value',
                name: '面积 (平方米)'
            },
            yAxis: {
                type: 'value',
                name: '价格 (万元)'
            },
            series: [
                {
                    symbolSize: function (data) {
                        return data[2] * 0.5; // 根据成交量调整气泡大小
                    },
                    data: {{ priceAreaData | tojson }},
                    type: 'scatter',
                    itemStyle: {
                        color: function(params) {
                            // 根据成交量设置颜色
                            const colors = ['#5470c6', '#91cc75', '#fac858', '#ee6666', '#73c0de', '#3ba272', '#fc8452', '#9a60b4', '#ea7ccc'];
                            return colors[params.dataIndex % colors.length];
                        }
                    }
                }
            ]
        };


        // 渲染所有图表

        areaHeatChart.setOption(areaHeatOption);
        buildingTypeChart.setOption(buildingTypeOption);
        priceAreaChart.setOption(priceAreaOption);
        funnelChart.setOption(funnelOption);

        // 响应式调整
        window.addEventListener('resize', function() {
            areaHeatChart.resize();
            buildingTypeChart.resize();
            priceAreaChart.resize();
            funnelChart.resize();
        });
    </script>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </body>
</html>